---
layout: single
title: "[머신러닝] 타이타닉 데이터 분석"
categories: ['ML', 'Kaggle']
tags: ['python', 'Kaggle', 'Machine Learning']
---

![image](https://user-images.githubusercontent.com/59822430/111163179-db619380-85d7-11eb-86d8-48f85cf27b76.png)

# * [머신러닝] 타이타닉 분석

- kaggle: https://www.kaggle.com/c/titanic

- kaggle에서 제공하는 타이타닉 데이터를 통해 생존자와 사망자를 예측하는 모델 만들기. 
- 모델 생성 후 실제 사망자 데이터와 비교해보기 



## 1. 문제정의

- 타이타닉 탑승객의 데이터를 활용해서 생존자 / 사망자를 예측해보자.
- kaggle에서 좋은(높은) 점수를 받는 것을 목표로 잡는다.
  

## 2. 데이터 수집
- kaggle 사이트에서 train, test, gender_submission 불러오기


```python
# data analysis and wrangling
import numpy as np
import pandas as pd

# visualization (데이터 시각화 라이브러리)
import matplotlib.pyplot as plt
import seaborn as sns
```


```python
#data 
train = pd.read_csv('./train.csv')
test = pd.read_csv('./test.csv')
train.head()
test.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PassengerId</th>
      <th>Pclass</th>
      <th>Name</th>
      <th>Sex</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Ticket</th>
      <th>Fare</th>
      <th>Cabin</th>
      <th>Embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>892</td>
      <td>3</td>
      <td>Kelly, Mr. James</td>
      <td>male</td>
      <td>34.5</td>
      <td>0</td>
      <td>0</td>
      <td>330911</td>
      <td>7.8292</td>
      <td>NaN</td>
      <td>Q</td>
    </tr>
    <tr>
      <th>1</th>
      <td>893</td>
      <td>3</td>
      <td>Wilkes, Mrs. James (Ellen Needs)</td>
      <td>female</td>
      <td>47.0</td>
      <td>1</td>
      <td>0</td>
      <td>363272</td>
      <td>7.0000</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>2</th>
      <td>894</td>
      <td>2</td>
      <td>Myles, Mr. Thomas Francis</td>
      <td>male</td>
      <td>62.0</td>
      <td>0</td>
      <td>0</td>
      <td>240276</td>
      <td>9.6875</td>
      <td>NaN</td>
      <td>Q</td>
    </tr>
    <tr>
      <th>3</th>
      <td>895</td>
      <td>3</td>
      <td>Wirz, Mr. Albert</td>
      <td>male</td>
      <td>27.0</td>
      <td>0</td>
      <td>0</td>
      <td>315154</td>
      <td>8.6625</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <th>4</th>
      <td>896</td>
      <td>3</td>
      <td>Hirvonen, Mrs. Alexander (Helga E Lindqvist)</td>
      <td>female</td>
      <td>22.0</td>
      <td>1</td>
      <td>1</td>
      <td>3101298</td>
      <td>12.2875</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
  </tbody>
</table>
</div>



## 3. 데이터 전처리

- 결측값, 이상값이 있는지 확인한다.
- 도출하고자 하는 결론과 관계가 없는 컬럼이 있는지 컬럼과 주제의 상관성을 고려한다.

- 데이터 전처리는 행 열의 동일한 전처리가 중요하다. (행, 열 전처리를 한꺼번에 진행한다.)


```python
# train 컬럼 확인 
train.columns.unique
```




    <bound method Index.unique of Index(['PassengerId', 'Survived', 'Pclass', 'Name', 'Sex', 'Age', 'SibSp',
           'Parch', 'Ticket', 'Fare', 'Cabin', 'Embarked'],
          dtype='object')>

#### 결측치 확인 
- Age, Cabin, Embarked 컬럼에 결측치가 있음을 확인할 수 있다.  

```python
train.info()
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 891 entries, 0 to 890
    Data columns (total 12 columns):
     #   Column       Non-Null Count  Dtype  
    ---  ------       --------------  -----  
     0   PassengerId  891 non-null    int64  
     1   Survived     891 non-null    int64  
     2   Pclass       891 non-null    int64  
     3   Name         891 non-null    object 
     4   Sex          891 non-null    object 
     5   Age          714 non-null    float64
     6   SibSp        891 non-null    int64  
     7   Parch        891 non-null    int64  
     8   Ticket       891 non-null    object 
     9   Fare         891 non-null    float64
     10  Cabin        204 non-null    object 
     11  Embarked     889 non-null    object 
    dtypes: float64(2), int64(5), object(5)
    memory usage: 83.7+ KB

#### 이상치 확인
- Fare 에 비교적 높은 값이 있으나 이상치인지 실제로 높은 금액을 지불한 것인지는 확인되지 않는다.
- 따라서 이상치가 없는 것으로 판단한다.  

```python
train.describe()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PassengerId</th>
      <th>Survived</th>
      <th>Pclass</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Fare</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>891.000000</td>
      <td>891.000000</td>
      <td>891.000000</td>
      <td>714.000000</td>
      <td>891.000000</td>
      <td>891.000000</td>
      <td>891.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>446.000000</td>
      <td>0.383838</td>
      <td>2.308642</td>
      <td>29.699118</td>
      <td>0.523008</td>
      <td>0.381594</td>
      <td>32.204208</td>
    </tr>
    <tr>
      <th>std</th>
      <td>257.353842</td>
      <td>0.486592</td>
      <td>0.836071</td>
      <td>14.526497</td>
      <td>1.102743</td>
      <td>0.806057</td>
      <td>49.693429</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.420000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>223.500000</td>
      <td>0.000000</td>
      <td>2.000000</td>
      <td>20.125000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>7.910400</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>446.000000</td>
      <td>0.000000</td>
      <td>3.000000</td>
      <td>28.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>14.454200</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>668.500000</td>
      <td>1.000000</td>
      <td>3.000000</td>
      <td>38.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>31.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>891.000000</td>
      <td>1.000000</td>
      <td>3.000000</td>
      <td>80.000000</td>
      <td>8.000000</td>
      <td>6.000000</td>
      <td>512.329200</td>
    </tr>
  </tbody>
</table>
</div>




```python
test.describe()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PassengerId</th>
      <th>Pclass</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Fare</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>418.000000</td>
      <td>418.000000</td>
      <td>332.000000</td>
      <td>418.000000</td>
      <td>418.000000</td>
      <td>417.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1100.500000</td>
      <td>2.265550</td>
      <td>30.272590</td>
      <td>0.447368</td>
      <td>0.392344</td>
      <td>35.627188</td>
    </tr>
    <tr>
      <th>std</th>
      <td>120.810458</td>
      <td>0.841838</td>
      <td>14.181209</td>
      <td>0.896760</td>
      <td>0.981429</td>
      <td>55.907576</td>
    </tr>
    <tr>
      <th>min</th>
      <td>892.000000</td>
      <td>1.000000</td>
      <td>0.170000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>996.250000</td>
      <td>1.000000</td>
      <td>21.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>7.895800</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1100.500000</td>
      <td>3.000000</td>
      <td>27.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>14.454200</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1204.750000</td>
      <td>3.000000</td>
      <td>39.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>31.500000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1309.000000</td>
      <td>3.000000</td>
      <td>76.000000</td>
      <td>8.000000</td>
      <td>9.000000</td>
      <td>512.329200</td>
    </tr>
  </tbody>
</table>
</div>

#### Passengerid 컬럼 삭제

- Passengerid는 순서를 나타내는 데이터이므로 생존 예측에는 영향을 미치지 않을 것이므로 컬럼을 삭제한다.  
 
- del DataFrame['삭제할 컬럼'] : 열 삭제만 가능 (키워드)
- DataFrame.drop('삭제할 컬럼') : 행 / 열의 삭제가 가능


```python
del train['PassengerId']
```


```python
train.columns.unique
```




    <bound method Index.unique of Index(['Survived', 'Pclass', 'Name', 'Sex', 'Age', 'SibSp', 'Parch', 'Ticket',
           'Fare', 'Cabin', 'Embarked'],
          dtype='object')>




```python
test.drop('PassengerId', axis=1, inplace=True)
```


```python
test.columns.unique
```




    <bound method Index.unique of Index(['Pclass', 'Name', 'Sex', 'Age', 'SibSp', 'Parch', 'Ticket', 'Fare',
           'Cabin', 'Embarked'],
          dtype='object')>

#### 정답 컬럼 분리
- train, test 컬럼의 비교를 위해 Survived 컬럼은 삭제한다. 

```python
y_train = train['Survived']
train 에서 Survived 컬럼 삭제
train.drop('Survived', axis=1, inplace=True)
```


```python
train.shape
```




    (891, 11)




```python
test.shape
```




    (418, 10)
    

## 결측치 채우기

```python
# 공통 : age, cabin
# train : Embarked
# test : Fare
```

### train : Embarked 데이터 결측치 채우기

- value_counts() : 컬럼 안에 값들의 개수
- S가 가장 많다는 것을 알 수 있음.


```python
train['Embarked'].value_counts(normalize=True)
```




    S    0.724409
    C    0.188976
    Q    0.086614
    Name: Embarked, dtype: float64

- 최빈값 S로 결측치 채우기
- 결측치가 적은 경우에만 추천함.



- fillna() 함수 활용

- fillna('S')


```python
train['Embarked'].fillna('S', inplace = True)
```



### test: Fare 데이터 결측치 채우기


```python
test['Fare'].value_counts()
```




    7.7500     21
    26.0000    19
    8.0500     17
    13.0000    17
    7.8958     11
               ..
    9.3250      1
    14.4583     1
    15.0333     1
    25.4667     1
    21.0750     1
    Name: Fare, Length: 169, dtype: int64




```python
train['Fare'].describe()
```




    count    891.000000
    mean      32.204208
    std       49.693429
    min        0.000000
    25%        7.910400
    50%       14.454200
    75%       31.000000
    max      512.329200
    Name: Fare, dtype: float64

- 중앙값으로 채우기


```python
test['Fare'].fillna('14', inplace = True)
```

### 공통 : Age 데이터 결측치 채우기
- 다른 컬럼과의 상관관계를 통해서 결측치를 채워보자
- corr() 함수로 상관관계 파악
- 정확도는 -1 ~ 1 사이의 값으로 나타낸다.
- 양의 정수는 비례하는 정도를, 음의 정수는 반비례하는 정도를 의미한다.


```python
# - : 음의  상관관계, 반비례 (ex. -0.369 : 반비례 관계로, 36% 정도로 정확하다.)
# 숫자 컬럼만 나옴.
train.corr()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Survived</th>
      <th>Pclass</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Fare</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Survived</th>
      <td>1.000000</td>
      <td>-0.338481</td>
      <td>-0.077221</td>
      <td>-0.035322</td>
      <td>0.081629</td>
      <td>0.257307</td>
    </tr>
    <tr>
      <th>Pclass</th>
      <td>-0.338481</td>
      <td>1.000000</td>
      <td>-0.369226</td>
      <td>0.083081</td>
      <td>0.018443</td>
      <td>-0.549500</td>
    </tr>
    <tr>
      <th>Age</th>
      <td>-0.077221</td>
      <td>-0.369226</td>
      <td>1.000000</td>
      <td>-0.308247</td>
      <td>-0.189119</td>
      <td>0.096067</td>
    </tr>
    <tr>
      <th>SibSp</th>
      <td>-0.035322</td>
      <td>0.083081</td>
      <td>-0.308247</td>
      <td>1.000000</td>
      <td>0.414838</td>
      <td>0.159651</td>
    </tr>
    <tr>
      <th>Parch</th>
      <td>0.081629</td>
      <td>0.018443</td>
      <td>-0.189119</td>
      <td>0.414838</td>
      <td>1.000000</td>
      <td>0.216225</td>
    </tr>
    <tr>
      <th>Fare</th>
      <td>0.257307</td>
      <td>-0.549500</td>
      <td>0.096067</td>
      <td>0.159651</td>
      <td>0.216225</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>

- Age 컬럼과 Pclass 컬럼의 상관관계가 가장 높다는 것을 확인할 수 있다.


```python
train['Pclass'].value_counts()
```




    3    491
    1    216
    2    184
    Name: Pclass, dtype: int64


#### DataFrame.groupby() 함수

- 같은 값을 하나로 묶어 통계 또는 집계 결과를 얻기 위해 사용하는 것
- 그룹화 시킬 DataFrame 은 숫자로만 되있어야 한다.
- 전체 groupby 할 경우, 숫자로 된 DataFrame 내 데이터만 분석되어 나온다.
- Aggregation: 뒤에 함수를 지정하여 원하는 값을 도출해 낼 수 있다.

- ### Parameter
- `by`: **default=None**이다. 

- `axis`: **default=0**이다.
 
- `level`: **default=None**이다. 
 
- `as_index`: **default=True**이다.

- `sort`: **default=True**이다.
 
-  `group_keys`: **default=True**이다.


```python
    # 'A'별로 DataFrame 내 숫자 데이터를 보고 싶을 경우
    DataFrame.groupby('A').mean() 
    DataFrame.groupby('A').sum() 
    DataFrame.groupby('A').mean() 
    
    # 내가 만든 함수를 적용하고 싶을 때 agg() 
    DataFrame.groupby('A').agg('__')
```



- train의 Pclass 컬럼 별로 train 전체 컬럼(중 숫자 데이터) 값을 보여줌.


```python
train.groupby(train["Pclass"]).mean()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Survived</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Fare</th>
    </tr>
    <tr>
      <th>Pclass</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.629630</td>
      <td>38.233441</td>
      <td>0.416667</td>
      <td>0.356481</td>
      <td>84.154687</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.472826</td>
      <td>29.877630</td>
      <td>0.402174</td>
      <td>0.380435</td>
      <td>20.662183</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.242363</td>
      <td>25.140620</td>
      <td>0.615071</td>
      <td>0.393075</td>
      <td>13.675550</td>
    </tr>
  </tbody>
</table>
</div>

- train의 Embarked 컬럼 별로 train의 Pclass 컬럼의 평균 값을 보여줌.


```python
train['Pclass'].groupby(train["Embarked"]).agg('mean')
```




    Embarked
    C    1.886905
    Q    2.909091
    S    2.346749
    Name: Pclass, dtype: float64




```python
train['Pclass'].groupby(train["Embarked"]).mean()
```




    Embarked
    C    1.886905
    Q    2.909091
    S    2.346749
    Name: Pclass, dtype: float64

- Pclass, Sex 컬럼 별로 train 내 전체 데이터의 평균값을 보여줌.


```python
train.groupby(["Pclass", "Sex"]).mean()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Survived</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Fare</th>
    </tr>
    <tr>
      <th>Pclass</th>
      <th>Sex</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">1</th>
      <th>female</th>
      <td>0.968085</td>
      <td>34.611765</td>
      <td>0.553191</td>
      <td>0.457447</td>
      <td>106.125798</td>
    </tr>
    <tr>
      <th>male</th>
      <td>0.368852</td>
      <td>41.281386</td>
      <td>0.311475</td>
      <td>0.278689</td>
      <td>67.226127</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2</th>
      <th>female</th>
      <td>0.921053</td>
      <td>28.722973</td>
      <td>0.486842</td>
      <td>0.605263</td>
      <td>21.970121</td>
    </tr>
    <tr>
      <th>male</th>
      <td>0.157407</td>
      <td>30.740707</td>
      <td>0.342593</td>
      <td>0.222222</td>
      <td>19.741782</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">3</th>
      <th>female</th>
      <td>0.500000</td>
      <td>21.750000</td>
      <td>0.895833</td>
      <td>0.798611</td>
      <td>16.118810</td>
    </tr>
    <tr>
      <th>male</th>
      <td>0.135447</td>
      <td>26.507589</td>
      <td>0.498559</td>
      <td>0.224784</td>
      <td>12.661633</td>
    </tr>
  </tbody>
</table>
</div>

- Pclass, Sex 컬럼 별로 trian의 Pclass, Sex, Age 컬럼의 평균을 보여줌.


```python
train[['Pclass', 'Sex' , 'Age']].groupby(["Pclass", "Sex"]).mean()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Age</th>
    </tr>
    <tr>
      <th>Pclass</th>
      <th>Sex</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">1</th>
      <th>female</th>
      <td>34.611765</td>
    </tr>
    <tr>
      <th>male</th>
      <td>41.281386</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2</th>
      <th>female</th>
      <td>28.722973</td>
    </tr>
    <tr>
      <th>male</th>
      <td>30.740707</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">3</th>
      <th>female</th>
      <td>21.750000</td>
    </tr>
    <tr>
      <th>male</th>
      <td>26.507589</td>
    </tr>
  </tbody>
</table>
</div>

- 객실과 성별 별로 나이의 중앙값
- 중앙값을 결측치에 채우기 위해 age_table 에 담는다.

```python
age_table = train[['Pclass', 'Sex' , 'Age']].groupby(by=["Pclass", "Sex"]).median()
```


```python
age_table
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>Age</th>
    </tr>
    <tr>
      <th>Pclass</th>
      <th>Sex</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">1</th>
      <th>female</th>
      <td>35.0</td>
    </tr>
    <tr>
      <th>male</th>
      <td>40.0</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2</th>
      <th>female</th>
      <td>28.0</td>
    </tr>
    <tr>
      <th>male</th>
      <td>30.0</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">3</th>
      <th>female</th>
      <td>21.5</td>
    </tr>
    <tr>
      <th>male</th>
      <td>25.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
# Series 형태
age_table.loc[3,'female'][0]
```




    21.5




```python
# 튜플 방식으로 출력 (행, 열)
age_table.loc[(3,'female'), 'Age']
```




    21.5




```python
for i in range(1, 100):
    train.iloc[i]
```

#### np.isnan() 함수
- 데이터 값이 결측치인지 아닌지 확인해주는 함수
- 결측치를 채우는 함수를 만든다. 
- 결측치가 있다면 age_table 데이터 값으로 채워준다.   

```python
def fill_age(person):
    if np.isnan(person['Age']):
        return age_table.loc[person['Pclass'],person['Sex']][0]
    else:
        return person['Age']
```



```python
# fill_age 의 parameter

fill_age(train.iloc[1])
```


    38.0


```python
# 5번째 행의 age 는 null 이다.
np.isnan(train.iloc[5]['Age'])
```




    True




```python
### 결측치 확인
train.iloc[5]
```




    Survived                   0
    Pclass                     3
    Name        Moran, Mr. James
    Sex                     male
    Age                      NaN
    SibSp                      0
    Parch                      0
    Ticket                330877
    Fare                  8.4583
    Cabin                    NaN
    Embarked                   Q
    Name: 5, dtype: object




```python
# apply : 한 줄씩 입출력하는 것
train['Age'] = train.apply(fill_age, axis=1)
test['Age'] = test.apply(fill_age, axis=1)
```

### 공통: cabin 데이터 결측치 채우기
- 결측치 양이 많을 때는 상관관계를 보기가 어렵다.
- 모든 결측치를 하나의 값으로 채우는 방법을 택한다.
- 결측치 의미 : Cabin 값 확인을 못했다. (= 사망을 했거나 cabin 이 없는 3등급의 사람일 수 있다.)
- 원래 순서대로라면 결측치가 의미하는 게 무엇인지 상관관계를 먼저 파악해야 한다.


```python
# unique
train['Cabin'].unique()
```




    array([nan, 'C85', 'C123', 'E46', 'G6', 'C103', 'D56', 'A6',
           'C23 C25 C27', 'B78', 'D33', 'B30', 'C52', 'B28', 'C83', 'F33',
           'F G73', 'E31', 'A5', 'D10 D12', 'D26', 'C110', 'B58 B60', 'E101',
           'F E69', 'D47', 'B86', 'F2', 'C2', 'E33', 'B19', 'A7', 'C49', 'F4',
           'A32', 'B4', 'B80', 'A31', 'D36', 'D15', 'C93', 'C78', 'D35',
           'C87', 'B77', 'E67', 'B94', 'C125', 'C99', 'C118', 'D7', 'A19',
           'B49', 'D', 'C22 C26', 'C106', 'C65', 'E36', 'C54',
           'B57 B59 B63 B66', 'C7', 'E34', 'C32', 'B18', 'C124', 'C91', 'E40',
           'T', 'C128', 'D37', 'B35', 'E50', 'C82', 'B96 B98', 'E10', 'E44',
           'A34', 'C104', 'C111', 'C92', 'E38', 'D21', 'E12', 'E63', 'A14',
           'B37', 'C30', 'D20', 'B79', 'E25', 'D46', 'B73', 'C95', 'B38',
           'B39', 'B22', 'C86', 'C70', 'A16', 'C101', 'C68', 'A10', 'E68',
           'B41', 'A20', 'D19', 'D50', 'D9', 'A23', 'B50', 'A26', 'D48',
           'E58', 'C126', 'B71', 'B51 B53 B55', 'D49', 'B5', 'B20', 'F G63',
           'C62 C64', 'E24', 'C90', 'C45', 'E8', 'B101', 'D45', 'C46', 'D30',
           'E121', 'D11', 'E77', 'F38', 'B3', 'D6', 'B82 B84', 'D17', 'A36',
           'B102', 'B69', 'E49', 'C47', 'D28', 'E17', 'A24', 'C50', 'B42',
           'C148'], dtype=object)




```python
# unique
test['Cabin'].unique()
```




    array([nan, 'B45', 'E31', 'B57 B59 B63 B66', 'B36', 'A21', 'C78', 'D34',
           'D19', 'A9', 'D15', 'C31', 'C23 C25 C27', 'F G63', 'B61', 'C53',
           'D43', 'C130', 'C132', 'C101', 'C55 C57', 'B71', 'C46', 'C116',
           'F', 'A29', 'G6', 'C6', 'C28', 'C51', 'E46', 'C54', 'C97', 'D22',
           'B10', 'F4', 'E45', 'E52', 'D30', 'B58 B60', 'E34', 'C62 C64',
           'A11', 'B11', 'C80', 'F33', 'C85', 'D37', 'C86', 'D21', 'C89',
           'F E46', 'A34', 'D', 'B26', 'C22 C26', 'B69', 'C32', 'B78',
           'F E57', 'F2', 'A18', 'C106', 'B51 B53 B55', 'D10 D12', 'E60',
           'E50', 'E39 E41', 'B52 B54 B56', 'C39', 'B24', 'D28', 'B41', 'C7',
           'D40', 'D38', 'C105'], dtype=object)




```python
train['Cabin']
```




    0       NaN
    1       C85
    2       NaN
    3      C123
    4       NaN
           ... 
    886     NaN
    887     B42
    888     NaN
    889    C148
    890     NaN
    Name: Cabin, Length: 891, dtype: object




```python
# Object 형식은 indexing 할 수 없으므로 str 형식으로 바꿔준다.
# str 형식으로 나온 A,B,C (첫 번째 글자) 를 저장한다.
train['Cabin'] = train['Cabin'].str[0]
test['Cabin'] = test['Cabin'].str[0]
```

- 결측치를 'M' 값으로 채운다.
```python
train['Cabin'].fillna('M', inplace=True)
test['Cabin'].fillna('M', inplace=True)
```


```python
train['Cabin']
```




    0      M
    1      C
    2      M
    3      C
    4      M
          ..
    886    M
    887    B
    888    M
    889    C
    890    M
    Name: Cabin, Length: 891, dtype: object



- 결측치가 모두 채워진 것을 확인한다.
 
```python
train.info()
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 891 entries, 0 to 890
    Data columns (total 11 columns):
     #   Column    Non-Null Count  Dtype  
    ---  ------    --------------  -----  
     0   Survived  891 non-null    int64  
     1   Pclass    891 non-null    int64  
     2   Name      891 non-null    object 
     3   Sex       891 non-null    object 
     4   Age       891 non-null    float64
     5   SibSp     891 non-null    int64  
     6   Parch     891 non-null    int64  
     7   Ticket    891 non-null    object 
     8   Fare      891 non-null    float64
     9   Cabin     891 non-null    object 
     10  Embarked  891 non-null    object 
    dtypes: float64(2), int64(4), object(5)
    memory usage: 76.7+ KB



```python
test.info()
```

    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 418 entries, 0 to 417
    Data columns (total 10 columns):
     #   Column    Non-Null Count  Dtype  
    ---  ------    --------------  -----  
     0   Pclass    418 non-null    int64  
     1   Name      418 non-null    object 
     2   Sex       418 non-null    object 
     3   Age       418 non-null    float64
     4   SibSp     418 non-null    int64  
     5   Parch     418 non-null    int64  
     6   Ticket    418 non-null    object 
     7   Fare      418 non-null    object 
     8   Cabin     418 non-null    object 
     9   Embarked  418 non-null    object 
    dtypes: float64(1), int64(3), object(6)
    memory usage: 32.8+ KB


## 4. EDA 탐색적 데이터 분석
- 특성공학 : 컬럼에 연산을 통해서 의미있는 새로운 정보를 추출하는 행위
- SibSp(형제자매수) + Parch(부모자식수) +1 = Family_size

### Family_size column 분석


```python
# Family_size 컬럼 만들기
# SibSp, Parch 사이의 연관성
```


```python
test['Family_size']=test['SibSp'] + test['Parch'] + 1
```


```python
train['Family_size']=train['SibSp'] + train['Parch'] + 1
```
##### sns.countplot
- 그래프를 그려 연관성을 확인한다.
```python
# x 축 하나에 비교값이 여러 개 가능 (hue == 구분자) 
sns.countplot(data = train, x='Family_size', hue='Survived')
```




    <AxesSubplot:xlabel='Family_size', ylabel='count'>




​    
![output_63_1](https://user-images.githubusercontent.com/59822430/111161163-2b435900-85de-11eb-906e-328cdea5c109.png)
​    


##### 결과: 가족이 없는 경우 사망률이 더 높고, 2-4 명의 가족이 있는 경우 생존률이 비교적 높다.

### Cabin column 분석


```python
sns.countplot(data = train, x='Cabin', hue='Survived')
```




    <AxesSubplot:xlabel='Cabin', ylabel='count'>




​    
![output_66_1](https://user-images.githubusercontent.com/59822430/111161308-5af26100-85de-11eb-937e-c773cd7a1f30.png)
​    


##### 결과: M 에서 상대적으로 많은 사람이 죽었다. (M == null) 
- 생존 여부 판단에 사용해도 괜찮다.

### 수치형 데이터를 범주형 데이터로 바꿈. (Binning)


```python
# bins : 구간
# 0< x <=1 / 1< x <=4 / 4< x <=20
bins=[0,1,4,20]
# labels: 구간에 대한 범주 이름
# 0 < x <=1 == Alone 
labels = ['Alone','Small','Large']
# cut: 수치형 데이터를 범주형 데이터로 바꿔주는 것 (pandas 내 내장되어 있는 함수 > pd.cut)
# bins: 속성에 대한 이름, labels: 속성 값
train['Family_Group'] = pd.cut(train['Family_size'],bins=bins, labels=labels)
```


```python
train.columns
```



    Index(['Survived', 'Pclass', 'Name', 'Sex', 'Age', 'SibSp', 'Parch', 'Ticket',
           'Fare', 'Cabin', 'Embarked', 'Family_size', 'Family_Group'],
          dtype='object')




```python
test['Family_Group'] = pd.cut(test['Family_size'],bins=bins, labels=labels)
```


```python
sns.countplot(data = train, x='Family_Group', hue='Survived')
```




    <AxesSubplot:xlabel='Family_Group', ylabel='count'>




​    
![output_72_1](https://user-images.githubusercontent.com/59822430/111161401-75c4d580-85de-11eb-9137-99ae3058d6cd.png)
​    


##### Pclass column 분석


```python
sns.countplot(data = train, x='Pclass', hue='Survived')
```




    <AxesSubplot:xlabel='Pclass', ylabel='count'>




​    
![output_74_1](https://user-images.githubusercontent.com/59822430/111161407-76f60280-85de-11eb-8426-2c4ee92c96c3.png)
​    


##### 결과: 등급이 높아질수록 생존률이 높다.

### Cabin과 Pclass 컬럼 확인


```python
sns.countplot(data = train, x='Cabin', hue='Pclass')
```




    <AxesSubplot:xlabel='Cabin', ylabel='count'>




​    
![output_77_1](https://user-images.githubusercontent.com/59822430/111161414-78272f80-85de-11eb-9003-15aa3008c57c.png)
​    


##### 결과: M은 3등급 사람들이 많다. 사망자의 비율이 높음.
- A, B, C 구역에는 1등급만 존재한다. 생존 확률이 더 높다.

### Embarked column 분석


```python
sns.countplot(data = train, x='Embarked', hue='Survived')
```




    <AxesSubplot:xlabel='Embarked', ylabel='count'>




​    
![output_80_1](https://user-images.githubusercontent.com/59822430/111161418-79f0f300-85de-11eb-88c0-3062145a8b74.png)
​    


##### 결과: S, Q에서 탑승한 경우 사망률이 생존률보다 높다.

### Age column 확인


```python
# violinplot > 두 데이터 비교에 용이, 차지하는 크기는 데이터 수와 비례하지 않음. (비율과 비례함.)
sns.violinplot(data=train, x='Sex', y='Age', hue='Survived', split=True)
```




    <AxesSubplot:xlabel='Sex', ylabel='Age'>




​    
![output_83_1](https://user-images.githubusercontent.com/59822430/111161422-7b222000-85de-11eb-9154-b757ffb77af7.png)
​    


##### 결과
- 남자는 산 사람과 죽은 사람의 나이대가 차이가 있다.
- 여자는 산 사람과 죽은 사람의 나이대가 비슷하다.
- 어린 아이들의 경우 상대적으로 남자 아이의 생존률이 더 높다.

### Fare column 확인


```python
sns.violinplot(data=train, x='Sex', y='Fare', hue='Survived', split=True)
```




    <AxesSubplot:xlabel='Sex', ylabel='Fare'>




​    
![output_86_1](https://user-images.githubusercontent.com/59822430/111161430-7bbab680-85de-11eb-8b3f-12d59ea0ff39.png)
​    


##### 결과: 저렴한 요금을 낸 경우 사망률이 더 높다.


```python
sns.countplot(data = train, x='Sex', hue='Survived')
```




    <AxesSubplot:xlabel='Sex', ylabel='count'>




​    
![output_88_1](https://user-images.githubusercontent.com/59822430/111161608-ae64af00-85de-11eb-9785-ff9b92233067.png)
​    



```python
sns.countplot(data = train, y='Sex', hue='Survived')
```




    <AxesSubplot:xlabel='count', ylabel='Sex'>




​    
![output_89_1](https://user-images.githubusercontent.com/59822430/111161614-af95dc00-85de-11eb-958a-c519d75b3f5f.png)
​    


### 텍스트 데이터(비정형 데이터)는 머신러닝이 학습을 할 수 없다.

### Text 데이터
- Name, Ticket column
- 비정형 데이터를 특성공학을 통해 정형데이터로 만들어보자.


```python
# 이름 내 호칭을 사용할 수 있음. 
# 이름에 대한 특성 파악
# 첫 번째는 '성'과 ','이 들어감.
# 두 번째는 호칭 뒤에 '.(온점)'이 들어감.
train['Name'][0]
```




    'Braund, Mr. Owen Harris'




```python
# split 함수로 (',') 기준으로 나눔
# 나눈 데이터 중 두 번째 데이터 씀.
# 그 데이터를 다시 ('.') 기준으로 나눔.
# 나눈 데이터 중 첫 번째 데이터 씀.
# strip(): 문자 앞 뒤의 띄어쓰기(공백) 제거
train['Name'][0].split(',')[1].split('.')[0].strip()
```




    'Mr'




```python
# 함수 작성
# 테이블의 한 줄이 parameter 로 들어옴.
def split_title(name):
    return name.split(',')[1].split('.')[0].strip()
```


```python
train['Name'].apply(split_title)
```




    0        Mr
    1       Mrs
    2      Miss
    3       Mrs
    4        Mr
           ... 
    886     Rev
    887    Miss
    888    Miss
    889      Mr
    890      Mr
    Name: Name, Length: 891, dtype: object




```python
# Name 컬럼을 Title 로 바꾸기 
train['Title'] = train['Name'].apply(split_title)
test['Title'] = test['Name'].apply(split_title)
```


```python
train.drop('Name', axis=1, inplace=True)
```


```python
test.drop('Name', axis=1, inplace=True)
```


```python
train['Title'].value_counts()
```




    Mr              517
    Miss            182
    Mrs             125
    Master           40
    Dr                7
    Rev               6
    Col               2
    Mlle              2
    Major             2
    Mme               1
    Ms                1
    Don               1
    Sir               1
    the Countess      1
    Lady              1
    Jonkheer          1
    Capt              1
    Name: Title, dtype: int64




```python
# def map_title(name):
#     if(name == 'Mr' or 'Miss' or 'Mrs' or 'Master' or 'Dr'):
#         return name
#     else:
#         return name.map('Other')
```


```python
# train['Title2'] = train['Title'].apply(map_title)
```


```python
# train['Title2'][30]
```


```python
# train['Title2'].unique()
```

#### 호칭의 범주를 줄여보자.
- Mr Mrs Miss Master Dr Other
- Map 함수를 활용해서 mapping 


```python
convert_title_dic = {
    'Mr' : 'Mr' , 
    'Mrs' : 'Mrs', 
    'Miss' : 'Miss', 
    'Master' : 'Master', 
    'Don' : 'Other', 
    'Rev' : 'Rev', 
    'Dr': 'Other', 
    'Mme' : 'Other', 
    'Ms' : 'Other',
    'Major' : 'Other',
    'Lady' : 'Other',
    'Sir' : 'Other',
    'Mlle' : 'Other',
    'Col' : 'Other', 
    'Capt' : 'Other', 
    'the Countess' : 'Other',
    'Jonkheer' : 'Other',
    'Dona' : 'Other'
}
```


```python
train['Title'] = train['Title'].map(convert_title_dic)
test['Title'] = test['Title'].map(convert_title_dic)
```


```python
train['Title'].unique()
```




    array(['Mr', 'Mrs', 'Miss', 'Master', 'Other', 'Rev'], dtype=object)




```python
test['Title'].unique()
```




    array(['Mr', 'Mrs', 'Miss', 'Master', 'Other', 'Rev'], dtype=object)



##### Ticket data
- 중복되지 않는 값이 681개, 사용하기 어려움 > 삭제


```python
train['Ticket'].value_counts()
```




    1601        7
    CA. 2343    7
    347082      7
    3101295     6
    347088      6
               ..
    349223      1
    349246      1
    2697        1
    370372      1
    36967       1
    Name: Ticket, Length: 681, dtype: int64




```python
train['Ticket'].str[:1].value_counts()
```




    3    301
    2    183
    1    146
    P     65
    S     65
    C     47
    A     29
    W     13
    4     10
    7      9
    F      7
    6      6
    L      4
    5      3
    8      2
    9      1
    Name: Ticket, dtype: int64




```python
train.drop('Ticket', axis = 1, inplace = True)
```


```python
test.drop('Ticket', axis = 1, inplace = True)
```


```python
train.columns.unique()
```




    Index(['Survived', 'Pclass', 'Sex', 'Age', 'SibSp', 'Parch', 'Fare', 'Cabin',
           'Embarked', 'Family_size', 'Family_Group', 'Title'],
          dtype='object')




```python
train.shape, test.shape
```




    ((891, 12), (418, 11))



### 글자 데이터를 숫자 데이터로 변경해보자.
- 머신러닝 모델은 수치 데이터만 학습할 수 있기 때문에 문자 데이터를 수치 데이터로 변경해야 함.
- 인코딩 > OneHotEncoding
- 문자 데이터 > Sex, Cabin, Embarked, Family_group, Title


```python
# One-hot Encoding 함수
categorical_feature = ['Sex', 'Cabin', 'Embarked', 'Family_Group', 'Title']
```


```python
# train, test 함수를 합친 상태에서 진행해야 함. 
# 합친 후 다시 7:3 비율로 나눠야함.
```


```python
# 합칠 수 있도록 column 개수를 맞춰줘야 함.
train.shape, test.shape
```




    ((891, 12), (418, 11))




```python
# 정답 컬럼 분리
y_train = train['Survived']
# train 에서 Survived 컬럼 삭제
train.drop('Survived', axis=1, inplace=True)
```


```python
# concat : 행, 열을 기준으로 데이터프레임을 합침.
# merge : 데이터를 기준으로 데이터프레임을 합침.
```


```python
pd.concat([train, test])
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Pclass</th>
      <th>Sex</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Fare</th>
      <th>Cabin</th>
      <th>Embarked</th>
      <th>Family_size</th>
      <th>Family_Group</th>
      <th>Title</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>male</td>
      <td>22.0</td>
      <td>1</td>
      <td>0</td>
      <td>7.25</td>
      <td>M</td>
      <td>S</td>
      <td>2</td>
      <td>Small</td>
      <td>Mr</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>female</td>
      <td>38.0</td>
      <td>1</td>
      <td>0</td>
      <td>71.2833</td>
      <td>C</td>
      <td>C</td>
      <td>2</td>
      <td>Small</td>
      <td>Mrs</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>female</td>
      <td>26.0</td>
      <td>0</td>
      <td>0</td>
      <td>7.925</td>
      <td>M</td>
      <td>S</td>
      <td>1</td>
      <td>Alone</td>
      <td>Miss</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>female</td>
      <td>35.0</td>
      <td>1</td>
      <td>0</td>
      <td>53.1</td>
      <td>C</td>
      <td>S</td>
      <td>2</td>
      <td>Small</td>
      <td>Mrs</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>male</td>
      <td>35.0</td>
      <td>0</td>
      <td>0</td>
      <td>8.05</td>
      <td>M</td>
      <td>S</td>
      <td>1</td>
      <td>Alone</td>
      <td>Mr</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>413</th>
      <td>3</td>
      <td>male</td>
      <td>25.0</td>
      <td>0</td>
      <td>0</td>
      <td>8.05</td>
      <td>M</td>
      <td>S</td>
      <td>1</td>
      <td>Alone</td>
      <td>Mr</td>
    </tr>
    <tr>
      <th>414</th>
      <td>1</td>
      <td>female</td>
      <td>39.0</td>
      <td>0</td>
      <td>0</td>
      <td>108.9</td>
      <td>C</td>
      <td>C</td>
      <td>1</td>
      <td>Alone</td>
      <td>Other</td>
    </tr>
    <tr>
      <th>415</th>
      <td>3</td>
      <td>male</td>
      <td>38.5</td>
      <td>0</td>
      <td>0</td>
      <td>7.25</td>
      <td>M</td>
      <td>S</td>
      <td>1</td>
      <td>Alone</td>
      <td>Mr</td>
    </tr>
    <tr>
      <th>416</th>
      <td>3</td>
      <td>male</td>
      <td>25.0</td>
      <td>0</td>
      <td>0</td>
      <td>8.05</td>
      <td>M</td>
      <td>S</td>
      <td>1</td>
      <td>Alone</td>
      <td>Mr</td>
    </tr>
    <tr>
      <th>417</th>
      <td>3</td>
      <td>male</td>
      <td>25.0</td>
      <td>1</td>
      <td>1</td>
      <td>22.3583</td>
      <td>M</td>
      <td>C</td>
      <td>3</td>
      <td>Small</td>
      <td>Master</td>
    </tr>
  </tbody>
</table>
<p>1309 rows × 11 columns</p>
</div>




```python
combine = pd.concat([train, test], ignore_index=True)
```


```python
combine.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Pclass</th>
      <th>Sex</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Fare</th>
      <th>Cabin</th>
      <th>Embarked</th>
      <th>Family_size</th>
      <th>Family_Group</th>
      <th>Title</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>male</td>
      <td>22.0</td>
      <td>1</td>
      <td>0</td>
      <td>7.25</td>
      <td>M</td>
      <td>S</td>
      <td>2</td>
      <td>Small</td>
      <td>Mr</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>female</td>
      <td>38.0</td>
      <td>1</td>
      <td>0</td>
      <td>71.2833</td>
      <td>C</td>
      <td>C</td>
      <td>2</td>
      <td>Small</td>
      <td>Mrs</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>female</td>
      <td>26.0</td>
      <td>0</td>
      <td>0</td>
      <td>7.925</td>
      <td>M</td>
      <td>S</td>
      <td>1</td>
      <td>Alone</td>
      <td>Miss</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>female</td>
      <td>35.0</td>
      <td>1</td>
      <td>0</td>
      <td>53.1</td>
      <td>C</td>
      <td>S</td>
      <td>2</td>
      <td>Small</td>
      <td>Mrs</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>male</td>
      <td>35.0</td>
      <td>0</td>
      <td>0</td>
      <td>8.05</td>
      <td>M</td>
      <td>S</td>
      <td>1</td>
      <td>Alone</td>
      <td>Mr</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 원핫 인코딩
# get_dummies 함수
one_hot = pd.get_dummies(combine[categorical_feature])
```


```python
one_hot.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Sex_female</th>
      <th>Sex_male</th>
      <th>Cabin_A</th>
      <th>Cabin_B</th>
      <th>Cabin_C</th>
      <th>Cabin_D</th>
      <th>Cabin_E</th>
      <th>Cabin_F</th>
      <th>Cabin_G</th>
      <th>Cabin_M</th>
      <th>...</th>
      <th>Embarked_S</th>
      <th>Family_Group_Alone</th>
      <th>Family_Group_Small</th>
      <th>Family_Group_Large</th>
      <th>Title_Master</th>
      <th>Title_Miss</th>
      <th>Title_Mr</th>
      <th>Title_Mrs</th>
      <th>Title_Other</th>
      <th>Title_Rev</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 23 columns</p>
</div>




```python
# 기존 문자데이터 삭제
combine.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Pclass</th>
      <th>Sex</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Fare</th>
      <th>Cabin</th>
      <th>Embarked</th>
      <th>Family_size</th>
      <th>Family_Group</th>
      <th>Title</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>male</td>
      <td>22.0</td>
      <td>1</td>
      <td>0</td>
      <td>7.25</td>
      <td>M</td>
      <td>S</td>
      <td>2</td>
      <td>Small</td>
      <td>Mr</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>female</td>
      <td>38.0</td>
      <td>1</td>
      <td>0</td>
      <td>71.2833</td>
      <td>C</td>
      <td>C</td>
      <td>2</td>
      <td>Small</td>
      <td>Mrs</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>female</td>
      <td>26.0</td>
      <td>0</td>
      <td>0</td>
      <td>7.925</td>
      <td>M</td>
      <td>S</td>
      <td>1</td>
      <td>Alone</td>
      <td>Miss</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>female</td>
      <td>35.0</td>
      <td>1</td>
      <td>0</td>
      <td>53.1</td>
      <td>C</td>
      <td>S</td>
      <td>2</td>
      <td>Small</td>
      <td>Mrs</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>male</td>
      <td>35.0</td>
      <td>0</td>
      <td>0</td>
      <td>8.05</td>
      <td>M</td>
      <td>S</td>
      <td>1</td>
      <td>Alone</td>
      <td>Mr</td>
    </tr>
  </tbody>
</table>
</div>




```python
# combine 함수 내 categoricatl_feature(문자 데이터 전부)를 삭제한다.
combine.drop(categorical_feature, axis=1, inplace=True)
```


```python
combine.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Pclass</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Fare</th>
      <th>Family_size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>22.0</td>
      <td>1</td>
      <td>0</td>
      <td>7.25</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>38.0</td>
      <td>1</td>
      <td>0</td>
      <td>71.2833</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>26.0</td>
      <td>0</td>
      <td>0</td>
      <td>7.925</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>35.0</td>
      <td>1</td>
      <td>0</td>
      <td>53.1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>35.0</td>
      <td>0</td>
      <td>0</td>
      <td>8.05</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 지운 후, one_hot encoding data 를 합쳐준다. total_combine 함수에 저장 
total_combine = pd.concat([combine, one_hot], axis=1)
```


```python
total_combine.shape
```




    (1309, 29)




```python
total_combine.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Pclass</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Fare</th>
      <th>Family_size</th>
      <th>Sex_female</th>
      <th>Sex_male</th>
      <th>Cabin_A</th>
      <th>Cabin_B</th>
      <th>...</th>
      <th>Embarked_S</th>
      <th>Family_Group_Alone</th>
      <th>Family_Group_Small</th>
      <th>Family_Group_Large</th>
      <th>Title_Master</th>
      <th>Title_Miss</th>
      <th>Title_Mr</th>
      <th>Title_Mrs</th>
      <th>Title_Other</th>
      <th>Title_Rev</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>22.0</td>
      <td>1</td>
      <td>0</td>
      <td>7.25</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>38.0</td>
      <td>1</td>
      <td>0</td>
      <td>71.2833</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>26.0</td>
      <td>0</td>
      <td>0</td>
      <td>7.925</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>35.0</td>
      <td>1</td>
      <td>0</td>
      <td>53.1</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>35.0</td>
      <td>0</td>
      <td>0</td>
      <td>8.05</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 29 columns</p>
</div>



### 5. 모델 선택 및 하이퍼파라미터 조정 


```python
from sklearn.tree import DecisionTreeClassifier # 분류
```


```python
tree_model = DecisionTreeClassifier() 
```

### 6. 학습


```python
X_train = total_combine.iloc[:891]
X_test = total_combine.iloc[891:]
print(X_train.shape)
print(X_test.shape)
print(y_train.shape)
```

    (891, 29)
    (418, 29)
    (891,)



```python
tree_model.fit(X_train, y_train)
```




    DecisionTreeClassifier()




```python
pre = tree_model.predict(X_test)
```


```python
gender = pd.read_csv('./gender_submission.csv')
```


```python
# gender DataFrame 에 Survived 라는 컬럼으로 pre 값 저장 
gender['Survived']= pre
```


```python
gender.to_csv('mySubmission01.csv', index=False)
```
